<!DOCTYPE html>
<html ng-app="dragdrop">
<head>
    <title>Task1</title>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
    <script>    
        let dragApp = angular.module('dragdrop', []);
        dragApp.directive('myDraggable', ['$document', function($document) {
            return {
                scope: {
                    data: '=',
                    dropVal: '&callbackFn' 
                },
                link: function(scope, element, attr) {
                    var startX = 0, startY = 0, x = 0, y = 0;
                    

                    element.css({
                    position: 'relative',
                    border: '1px solid red',
                    backgroundColor: 'lightgrey',
                    cursor: 'pointer'
                    });

                    element.on('mousedown', function(event) {
                        // Prevent default dragging of selected content
                        event.preventDefault();
                        startX = event.pageX - x;
                        startY = event.pageY - y;
                        $document.on('mousemove', mousemove);
                        $document.on('mouseup', mouseup);
                    });

                    function mousemove(event) {
                        y = event.pageY - startY;
                        x = event.pageX - startX;
                        element.css({
                        top: y + 'px',
                        left:  x + 'px'
                        });
                        
                    }

                    function mouseup(event) {
                        $document.off('mousemove', mousemove);
                        $document.off('mouseup', mouseup);
                        console.log(scope.data[event.target.firstChild.data]);
                        let textArea = document.getElementById("textArea");
                        if(event.pageX>textArea.offsetLeft && event.pageX<(textArea.offsetLeft+textArea.offsetWidth) && event.pageY>textArea.offsetTop && event.pageY<(textArea.offsetTop+textArea.offsetHeight)){
                            scope.dropVal({arg: scope.data[event.target.firstChild.data]})
                            scope.$apply();
                            y=0;
                            x=0;
                            element.css({
                                top: y + 'px',
                                left:  x + 'px'
                            });
                        }
                        
                    }
                },

            };
        }]);
        dragApp.controller('DragCtrl', function ($scope){
            $scope.hardCodedData = {
                date : "01.01.2000",
                text : "birthdayGirl",
            }
            $scope.droping = function(arg){
                if($scope.inputArea == undefined){
                    $scope.inputArea = arg;
                }
                else{
                    $scope.inputArea += arg;
                }  
                console.log($scope.inputArea);        
            }
        });

    </script>
</head>
<body ng-app="dragdrop" ng-controller="DragCtrl">
        <textarea id="textArea" rows="4" cols="50" ng-model="inputArea"> </textarea>
        <span my-draggable data="hardCodedData" callback-fn="droping(arg)"  ng-repeat="(key, value) in hardCodedData">{{key}}</span>
</body>
</html>